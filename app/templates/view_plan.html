{% extends "base.html" %}

{% block title %}Radio planas - {{ plan.campaign_name }}{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <!-- Header Section -->
    <div class="header-section mb-4">
        <div class="header-card">
            <div class="header-top">
                <div class="campaign-title">
                    <h1 style="color: white;">{{ plan.campaign_name }}</h1>
                    <span class="campaign-subtitle" style="color: rgba(255, 255, 255, 0.9);">Radijo kampanijos planavimas</span>
                </div>
                <div class="header-actions">
                    <button href="/api/plans/{{ plan.id }}/export" class="btn-professional btn-primary">
                        <i class="bi bi-download"></i>
                        <span>Eksportuoti</span>
                    </button>
                    <a href="/planning/new" class="btn-professional btn-secondary">
                        <i class="bi bi-arrow-left"></i>
                        <span>Atgal</span>
                    </a>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-item">
                    <div class="info-header">
                        <i class="bi bi-building info-icon"></i>
                        <span class="info-label">Agentūra</span>
                    </div>
                    <div class="info-value">BPN LT</div>
                </div>

                <div class="info-item">
                    <div class="info-header">
                        <i class="bi bi-person-badge info-icon"></i>
                        <span class="info-label">Klientas</span>
                    </div>
                    <div class="info-value">{{ plan.client_brand_name }}</div>
                </div>

                <div class="info-item">
                    <div class="info-header">
                        <i class="bi bi-megaphone info-icon"></i>
                        <span class="info-label">Kampanija</span>
                    </div>
                    <div class="info-value">{{ plan.campaign_name }}</div>
                </div>

                <div class="info-item">
                    <div class="info-header">
                        <i class="bi bi-people info-icon"></i>
                        <span class="info-label">Tikslinė grupė</span>
                    </div>
                    <div class="info-value">{{ plan.target_audience }}</div>
                </div>

                <div class="info-item">
                    <div class="info-header">
                        <i class="bi bi-calendar-range info-icon"></i>
                        <span class="info-label">Laikotarpis</span>
                    </div>
                    <div class="info-value">{{ plan.start_date }} - {{ plan.end_date }}</div>
                </div>

                <div class="info-item">
                    <div class="info-header">
                        <i class="bi bi-geo-alt info-icon"></i>
                        <span class="info-label">Šalis</span>
                    </div>
                    <div class="info-value">Lietuva</div>
                </div>
            </div>

            <div class="clips-section">
                <div class="info-item full-width">
                    <div class="info-header">
                        <i class="bi bi-film info-icon"></i>
                        <span class="info-label">Klipų informacija</span>
                    </div>
                    <div class="info-value">
                        {% set clips_list = plan.clips.all() %}
                        {% if clips_list %}
                            {% for clip in clips_list %}
                                {{ clip.name }} ({{ clip.duration }}s){% if not loop.last %}, {% endif %}
                            {% endfor %}
                        {% else %}
                            Nėra pridėtų klipų
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Section -->
    <div class="mb-4">
        <!-- Calendar Section -->
        <div class="professional-section">
            <div class="section-header">
                <div class="section-title">
                    <h3>Planavimo kalendorius</h3>
                    <span class="section-subtitle">{{ plan.start_date }} - {{ plan.end_date }}</span>
                </div>
            </div>

            <div class="table-container">
                <div class="table-responsive">
                    <table class="professional-table" id="calendar-table">
                        <thead>
                            <tr id="calendar-header">
                                <th class="station-column">Radijo stotis</th>
                                <!-- Date headers will be generated here -->
                            </tr>
                        </thead>
                        <tbody id="calendar-body">
                            <!-- Station rows with input cells will be generated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Discount Controls -->
    <div class="professional-section mb-4">
        <div class="section-header">
            <div class="section-title">
                <h3>Nuolaidų valdymas</h3>
                <span class="section-subtitle">Pritaikykite nuolaidas visam planui</span>
            </div>
        </div>

        <div class="controls-grid">
            <div class="control-item">
                <label class="control-label">Mūsų nuolaida (%)</label>
                <div class="input-group-professional">
                    <input type="number"
                           class="form-control-professional"
                           id="globalOurDiscount"
                           value="{{ plan.our_discount }}"
                           min="0"
                           max="100"
                           step="1">
                    <span class="input-suffix">%</span>
                </div>
            </div>

            <div class="control-item">
                <label class="control-label">Kliento nuolaida (%)</label>
                <div class="input-group-professional">
                    <input type="number"
                           class="form-control-professional"
                           id="globalClientDiscount"
                           value="{{ plan.client_discount }}"
                           min="0"
                           max="100"
                           step="1">
                    <span class="input-suffix">%</span>
                </div>
            </div>

            <div class="control-item">
                <button class="btn-professional btn-primary btn-full" onclick="applyDiscountsToAll()">
                    <i class="bi bi-check-circle"></i>
                    <span>Pritaikyti visoms eilutėms</span>
                </button>
            </div>

            <div class="control-item">
                <small class="help-text">
                    Įrašykite nuolaidas ir paspauskite "Pritaikyti" kad atnaujinti visą lentelę
                </small>
            </div>
        </div>
    </div>

    <!-- Excel-style Planning Tables - Each Station Separate -->
    {% for station in stations %}
    <div class="professional-section station-section" data-station-id="{{ station.id }}">
        <div class="section-header">
            <div class="section-title">
                <h3>
                    <i class="bi bi-broadcast"></i>
                    {{ station.name }}
                </h3>
                <span class="section-subtitle">Kampanijos spotų paskirstymas ir finansinė analizė</span>
            </div>
        </div>

        <div class="planning-table-container">
            <div class="table-responsive station-table-wrapper" data-station-id="{{ station.id }}">
                <table class="planning-table">
                    <thead>
                        <tr class="main-header">
                            <th rowspan="2" class="station-header">Kanalas</th>
                            <th rowspan="2" class="time-header">Laikas</th>
                            <th rowspan="2" class="weekday-header">Savaitės<br>diena</th>
                            <th rowspan="2" class="spec-header">Spec.<br>pozicija</th>
                            <th rowspan="2" class="count-header">Klipų<br>skaičius</th>
                            <th rowspan="2" class="duration-header">Klipo<br>trukmė</th>
                            <th colspan="5" class="rating-group-header">Reitingai ir efektyvumas</th>
                            <th colspan="5" class="pricing-group-header">Kainodara</th>
                            <th colspan="4" class="totals-group-header">Viso sumos</th>
                            <th colspan="2" class="discount-group-header">Nuolaidos</th>
                            <!-- Calendar date headers will be added here -->
                        </tr>
                        <tr class="sub-header">
                            <!-- Rating columns -->
                            <th class="grp-header">GRP</th>
                            <th class="trp-header">TRP</th>
                            <th class="total-grp-header">Viso<br>GRP</th>
                            <th class="total-trp-header">Viso<br>TRP</th>
                            <th class="affinity-header">Affinity</th>
                            <!-- Pricing columns -->
                            <th class="trp-price-header">1 sec TRP<br>kaina</th>
                            <th class="base-price-header">Įkainis</th>
                            <th class="seasonal-header">Antkainis</th>
                            <th class="price-with-index-header">Antkainis<br>padidintas</th>
                            <th class="clip-price-header">Klipo kaina<br>EUR</th>
                            <!-- Totals columns -->
                            <th class="final-price-header">Kaina po<br>nuolaidos EUR</th>
                            <th class="total-before-header">Viso kaina<br>iki nuolaidos</th>
                            <th class="total-after-header">Viso kaina<br>po nuolaidos</th>
                            <th class="our-discount-header">Mūsų nuolaida %</th>
                            <th class="client-discount-header">Kliento nuolaida %</th>
                            <!-- Date headers -->
                            {% for date in calendar_data.dates %}
                                <th class="calendar-date-header {% if date.weekday() >= 5 %}weekend-date{% endif %}">
                                    <div class="date-info">
                                        <span class="date-day">{{ date.strftime('%d') }}</span>
                                        <span class="date-month">{{ date.strftime('%m') }}</span>
                                    </div>
                                </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody class="station-tbody">
                        <!-- All weekday rows first -->
                        {% for time_slot in time_slots %}
                            <tr class="planning-row station-{{ station.id }}-row" data-station-id="{{ station.id }}" data-time-slot="{{ time_slot }}" data-is-weekend="false">
                                <td>{{ station.name }}</td>
                                <td>{{ time_slot }}</td>
                                <td>I-V</td>
                                <td>0</td>
                                <td class="spot-count">0</td>
                                <td class="clip-duration">{% set clips_list = plan.clips.all() %}{% if clips_list and clips_list|length > 0 %}{{ clips_list[0].duration }}{% else %}30{% endif %}</td>
                                <td class="grp">0</td>
                                <td class="trp">0</td>
                                <td class="total-grp">0</td>
                                <td class="total-trp">0</td>
                                <td class="affinity">0</td>
                                <td class="trp-price">0</td>
                                <td class="base-price">0</td>
                                <td class="seasonal-index">{{ seasonal_indices.get(station.id, 1.0) }}</td>
                                <td class="price-with-index">0</td>
                                <td class="clip-price">0</td>
                                <td class="final-price">0</td>
                                <td class="total-before-discount">0</td>
                                <td class="total-after-discount">0</td>
                                <td class="our-discount-percent">{{ plan.our_discount }}%</td>
                                <td class="client-discount-percent">{{ plan.client_discount }}%</td>
                                <!-- Calendar cells for each date - only weekdays clickable -->
                                {% for date in calendar_data.dates %}
                                    {% set is_weekend = date.weekday() >= 5 %}
                                    <td class="calendar-cell {% if is_weekend %}weekend-cell{% endif %}"
                                        data-date="{{ date.isoformat() }}"
                                        {% if not is_weekend %}onclick="toggleSpot(this)"{% endif %}>
                                        <span class="spot-indicator"></span>
                                    </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}

                        <!-- All weekend rows after -->
                        {% for time_slot in time_slots %}
                            <tr class="planning-row station-{{ station.id }}-row weekend-row" data-station-id="{{ station.id }}" data-time-slot="{{ time_slot }}" data-is-weekend="true">
                                <td>{{ station.name }}</td>
                                <td>{{ time_slot }}</td>
                                <td>VI-VII</td>
                                <td>0</td>
                                <td class="spot-count">0</td>
                                <td class="clip-duration">{% set clips_list = plan.clips.all() %}{% if clips_list and clips_list|length > 0 %}{{ clips_list[0].duration }}{% else %}30{% endif %}</td>
                                <td class="grp">0</td>
                                <td class="trp">0</td>
                                <td class="total-grp">0</td>
                                <td class="total-trp">0</td>
                                <td class="affinity">0</td>
                                <td class="trp-price">0</td>
                                <td class="base-price">0</td>
                                <td class="seasonal-index">{{ seasonal_indices.get(station.id, 1.0) }}</td>
                                <td class="price-with-index">0</td>
                                <td class="clip-price">0</td>
                                <td class="final-price">0</td>
                                <td class="total-before-discount">0</td>
                                <td class="total-after-discount">0</td>
                                <td class="our-discount-percent">{{ plan.our_discount }}%</td>
                                <td class="client-discount-percent">{{ plan.client_discount }}%</td>
                                <!-- Calendar cells for each date - only weekends clickable -->
                                {% for date in calendar_data.dates %}
                                    {% set is_weekend = date.weekday() >= 5 %}
                                    <td class="calendar-cell {% if is_weekend %}weekend-cell{% endif %}"
                                        data-date="{{ date.isoformat() }}"
                                        {% if is_weekend %}onclick="toggleSpot(this)"{% endif %}>
                                        <span class="spot-indicator"></span>
                                    </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}

                        <!-- Station totals row -->
                        <tr class="station-totals" data-station-id="{{ station.id }}" style="background-color: #fff3cd; font-weight: bold;">
                            <td colspan="2" style="text-align: right; padding-right: 10px;">VISO:</td>
                            <td></td>
                            <td></td>
                            <td class="station-total-spots" id="station-{{ station.id }}-total-spots">0</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="station-total-grp" id="station-{{ station.id }}-total-grp">0</td>
                            <td class="station-total-trp" id="station-{{ station.id }}-total-trp">0</td>
                            <td class="station-total-affinity" id="station-{{ station.id }}-total-affinity">0</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td class="station-total-before-discount" id="station-{{ station.id }}-total-before-discount">0</td>
                            <td class="station-total-after-discount" id="station-{{ station.id }}-total-after-discount">0</td>
                            <td></td>
                            <td></td>
                            <!-- Empty calendar cells for totals row -->
                            {% for date in calendar_data.dates %}
                                <td></td>
                            {% endfor %}
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}

{% block extra_css %}
<style>
/* Ensure GRP/TRP cells can display decimal values properly */
.grp, .trp, .total-grp, .total-trp, .affinity {
    min-width: 70px;
    white-space: nowrap;
    text-align: center;
    font-family: monospace;
}

/* Ensure station totals cells also display properly */
.station-total-grp, .station-total-trp, .station-total-affinity {
    min-width: 70px;
    white-space: nowrap;
    text-align: center;
    font-family: monospace;
}

/* Improve overall table cell spacing */
.radio-planning-table td {
    padding: 4px 6px;
    font-size: 13px;
}

/* Make numeric cells consistent */
.spot-count, .price-cell, .base-price, .final-price, .total-before-discount, .total-after-discount {
    text-align: center;
    font-family: monospace;
    min-width: 50px;
}

/* Weekend row styling - keep minimal styling */
.weekend-row {
    /* Same background as regular rows */
}

.weekend-row td {
    /* Same styling as regular rows */
}

/* Weekend calendar cells */
.weekend-cell {
    background-color: #e3f2fd !important;
    cursor: pointer;
}

/* Disabled weekend cells in weekday rows */
tr:not(.weekend-row) .weekend-cell {
    background-color: #f5f5f5 !important;
    cursor: not-allowed;
    opacity: 0.5;
}

/* Disabled weekday cells in weekend rows */
.weekend-row .calendar-cell:not(.weekend-cell) {
    background-color: #f5f5f5 !important;
    cursor: not-allowed;
    opacity: 0.5;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Load data on page load
document.addEventListener('DOMContentLoaded', function() {
    generateCalendarGrid();
    loadStationRatings();
    loadStationPrices();
    loadExistingSpots();
    initializeDragToScroll();
});

function generateCalendarGrid() {
    const startDate = new Date('{{ plan.start_date }}');
    const endDate = new Date('{{ plan.end_date }}');
    const calendarHeader = document.getElementById('calendar-header');
    const calendarBody = document.getElementById('calendar-body');

    if (!calendarHeader || !calendarBody) return;

    // Generate header with dates
    let headerHtml = '<th style="min-width: 150px;">Radijo stotis</th>';
    let currentDate = new Date(startDate);
    const dates = [];

    while (currentDate <= endDate) {
        const dayName = currentDate.toLocaleDateString('lt-LT', { weekday: 'short' });
        const dateStr = currentDate.toLocaleDateString('lt-LT', { day: '2-digit', month: '2-digit' });
        const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
        const dateIso = currentDate.toISOString().split('T')[0];

        dates.push({
            iso: dateIso,
            dayName: dayName,
            dateStr: dateStr,
            isWeekend: isWeekend
        });

        headerHtml += `
            <th class="text-center ${isWeekend ? 'weekend-header' : ''}" style="min-width: 80px;">
                <div class="fw-bold">${dayName}</div>
                <div class="small">${dateStr}</div>
            </th>
        `;

        currentDate.setDate(currentDate.getDate() + 1);
    }

    calendarHeader.innerHTML = headerHtml;

    // Generate body with station rows
    const stations = [
        {% for station in stations %}
        { id: {{ station.id }}, name: '{{ station.name }}' }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    let bodyHtml = '';
    stations.forEach(station => {
        bodyHtml += `<tr data-station-id="${station.id}">`;
        bodyHtml += `<td class="station-name-cell"><strong>${station.name}</strong></td>`;

        dates.forEach(date => {
            bodyHtml += `
                <td class="calendar-input-cell ${date.isWeekend ? 'weekend-cell' : ''}" data-date="${date.iso}" data-station-id="${station.id}">
                    <input type="number"
                           class="form-control form-control-sm text-center"
                           min="0"
                           max="99"
                           value="0"
                           style="width: 60px; font-size: 11px;"
                           onchange="updateSpotCount(this)">
                </td>
            `;
        });

        bodyHtml += '</tr>';
    });

    calendarBody.innerHTML = bodyHtml;
}

function loadStationRatings() {
    // Get all unique station IDs from the table
    const stationRows = document.querySelectorAll('.planning-row');
    const stationIds = new Set();

    stationRows.forEach(row => {
        const stationId = row.dataset.stationId;
        if (stationId) {
            stationIds.add(stationId);
        }
    });

    // Load ratings for each station
    stationIds.forEach(stationId => {
        fetch(`/api/radio-stations/${stationId}/ratings?target_audience={{ plan.target_audience }}`)
            .then(response => response.json())
            .then(ratings => {
                applyStationRatings(stationId, ratings);
            })
            .catch(error => {
                console.error(`Error loading ratings for station ${stationId}:`, error);
            });
    });
}

function applyStationRatings(stationId, ratings) {
    // Find all rows for this station
    const stationRows = document.querySelectorAll(`tr[data-station-id="${stationId}"]`);

    stationRows.forEach(row => {
        const timeSlot = row.dataset.timeSlot;
        const isWeekend = row.dataset.isWeekend === 'true';
        if (!timeSlot) return;

        // Find matching rating for this time slot and weekend status
        const rating = ratings.find(r => r.time_slot === timeSlot && r.is_weekend === isWeekend);

        if (rating) {
            // Update GRP and TRP values
            const grpCell = row.querySelector('.grp');
            const trpCell = row.querySelector('.trp');
            const affinityCell = row.querySelector('.affinity');

            if (grpCell) grpCell.textContent = rating.grp.toFixed(2);
            if (trpCell) trpCell.textContent = rating.trp.toFixed(2);
            if (affinityCell) affinityCell.textContent = rating.affinity.toFixed(2);
        }
    });
}

function loadStationPrices() {
    // Get all unique station IDs from the table
    const stationRows = document.querySelectorAll('.planning-row');
    const stationIds = new Set();

    stationRows.forEach(row => {
        const stationId = row.dataset.stationId;
        if (stationId) {
            stationIds.add(stationId);
        }
    });

    // Load prices for each station
    stationIds.forEach(stationId => {
        fetch(`/api/radio-stations/${stationId}/prices`)
            .then(response => response.json())
            .then(prices => {
                applyStationPrices(stationId, prices);
            })
            .catch(error => {
                console.error(`Error loading prices for station ${stationId}:`, error);
            });
    });
}

function applyStationPrices(stationId, prices) {
    // Find all rows for this station
    const stationRows = document.querySelectorAll(`tr[data-station-id="${stationId}"]`);

    stationRows.forEach(row => {
        const timeSlot = row.dataset.timeSlot;
        const isWeekend = row.dataset.isWeekend === 'true';
        if (!timeSlot) return;

        // Get clip duration from the row
        const clipDuration = parseInt(row.querySelector('.clip-duration').textContent || 30);

        // Use new API endpoint to get exact price for this duration
        fetch(`/api/radio-stations/${stationId}/price?time_slot=${encodeURIComponent(timeSlot)}&duration=${clipDuration}&is_weekend=${isWeekend}`)
            .then(response => response.json())
            .then(priceData => {
                // Update base price value with exact price from database
                const basePriceCell = row.querySelector('.base-price');
                if (basePriceCell && priceData.price) {
                    basePriceCell.textContent = priceData.price.toFixed(2);

                    // Trigger price calculations
                    calculateRowPrices(row);
                }
            })
            .catch(error => {
                console.error(`Error loading price for station ${stationId}, time ${timeSlot}, duration ${clipDuration}:`, error);
            });
    });
}

function calculateRowPrices(row) {
    // Get discount values from inputs (dynamic)
    const ourDiscount = parseFloat(document.getElementById('globalOurDiscount')?.value || {{ plan.our_discount }});
    const clientDiscount = parseFloat(document.getElementById('globalClientDiscount')?.value || {{ plan.client_discount }});

    // Get values from the row
    const basePrice = parseFloat(row.querySelector('.base-price').textContent || 0);
    const seasonalIndex = parseFloat(row.querySelector('.seasonal-index').textContent || 1.0);
    const spotCount = parseInt(row.querySelector('.spot-count').textContent || 0);

    // Calculate price with seasonal index
    const priceWithIndex = basePrice * seasonalIndex;
    row.querySelector('.price-with-index').textContent = priceWithIndex.toFixed(2);

    // Calculate clip price (single spot price after seasonal adjustment)
    row.querySelector('.clip-price').textContent = priceWithIndex.toFixed(2);

    // Calculate total before discount (price * spot count)
    const totalBeforeDiscount = priceWithIndex * spotCount;
    row.querySelector('.total-before-discount').textContent = totalBeforeDiscount.toFixed(2);

    // Apply discounts
    const priceAfterOurDiscount = totalBeforeDiscount * (1 - ourDiscount / 100);
    const finalPrice = priceAfterOurDiscount * (1 - clientDiscount / 100);
    row.querySelector('.final-price').textContent = priceWithIndex.toFixed(2); // Single spot final price
    row.querySelector('.total-after-discount').textContent = finalPrice.toFixed(2);

    // Calculate TRP price if TRP is available
    const trp = parseFloat(row.querySelector('.trp').textContent || 0);
    if (trp > 0) {
        const trpPrice = priceWithIndex / trp;
        row.querySelector('.trp-price').textContent = trpPrice.toFixed(2);
    }
}

function toggleSpot(cell) {
    const row = cell.closest('tr');
    const stationId = row.dataset.stationId;
    const timeSlot = row.dataset.timeSlot;
    const date = cell.dataset.date;

    // Toggle spot indicator
    const indicator = cell.querySelector('.spot-indicator');
    const currentCount = parseInt(indicator.textContent) || 0;
    const newCount = currentCount > 0 ? 0 : 1;

    indicator.textContent = newCount > 0 ? newCount : '';
    cell.classList.toggle('has-spot', newCount > 0);

    // Update totals
    updateRowTotals(row);
}

function updateRowTotals(row) {
    const calendarCells = row.querySelectorAll('.calendar-cell');
    let totalSpots = 0;

    calendarCells.forEach(cell => {
        const count = parseInt(cell.querySelector('.spot-indicator').textContent) || 0;
        totalSpots += count;
    });

    row.querySelector('.spot-count').textContent = totalSpots;
    row.querySelector('.total-grp').textContent = (totalSpots * parseFloat(row.querySelector('.grp').textContent || 0)).toFixed(2);
    row.querySelector('.total-trp').textContent = (totalSpots * parseFloat(row.querySelector('.trp').textContent || 0)).toFixed(2);

    // Recalculate prices based on new spot count
    calculateRowPrices(row);

    // Update station totals after updating row totals
    const stationId = row.dataset.stationId;
    updateStationTotals(stationId);

    // Update calendar view
    updateCalendarSpotCounts();
}

function updateSpotCount(input) {
    const stationId = input.closest('td').dataset.stationId;
    const date = input.closest('td').dataset.date;
    const spotCount = parseInt(input.value) || 0;

    // Update the main planning table
    const planningRows = document.querySelectorAll(`tr[data-station-id="${stationId}"]`);
    planningRows.forEach(row => {
        const cell = row.querySelector(`td[data-date="${date}"]`);
        if (cell) {
            const indicator = cell.querySelector('.spot-indicator');
            if (indicator) {
                indicator.textContent = spotCount > 0 ? spotCount : '';
                cell.classList.toggle('has-spot', spotCount > 0);
                updateRowTotals(row);
            }
        }
    });

    // Save to backend if needed
    if (spotCount > 0) {
        saveSpotToBackend(stationId, date, spotCount);
    }
}

function saveSpotToBackend(stationId, date, spotCount) {
    const spotData = {
        station_id: parseInt(stationId),
        date: date,
        time_slot: '06:00-10:00', // Default time slot, you might want to make this configurable
        spot_count: spotCount
    };

    fetch('/api/plans/{{ plan.id }}/spots', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(spotData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            console.error('Error saving spot:', data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function updateCalendarSpotCounts() {
    // This function is now simpler since the calendar inputs directly control the values
    // We just need to sync existing spots from the planning table to calendar inputs
    const calendarInputs = document.querySelectorAll('.calendar-input-cell input');

    calendarInputs.forEach(input => {
        const stationId = input.closest('td').dataset.stationId;
        const date = input.closest('td').dataset.date;

        // Find corresponding spot count in planning table
        let totalSpots = 0;
        const planningRows = document.querySelectorAll(`tr[data-station-id="${stationId}"]`);
        planningRows.forEach(row => {
            const cell = row.querySelector(`td[data-date="${date}"]`);
            if (cell) {
                const spotCount = parseInt(cell.querySelector('.spot-indicator')?.textContent) || 0;
                totalSpots += spotCount;
            }
        });

        input.value = totalSpots;
    });
}

function updateStationTotals(stationId) {
    const stationRows = document.querySelectorAll(`.station-${stationId}-row`);
    let totalSpots = 0;
    let totalGrp = 0;
    let totalTrp = 0;
    let totalBeforeDiscount = 0;
    let totalAfterDiscount = 0;

    stationRows.forEach(row => {
        totalSpots += parseInt(row.querySelector('.spot-count').textContent) || 0;
        totalGrp += parseFloat(row.querySelector('.total-grp').textContent) || 0;
        totalTrp += parseFloat(row.querySelector('.total-trp').textContent) || 0;
        totalBeforeDiscount += parseFloat(row.querySelector('.total-before-discount').textContent) || 0;
        totalAfterDiscount += parseFloat(row.querySelector('.total-after-discount').textContent) || 0;
    });

    // Calculate affinity (TRP / GRP)
    const totalAffinity = totalGrp > 0 ? (totalTrp / totalGrp).toFixed(2) : 0;

    // Update station total cells
    document.getElementById(`station-${stationId}-total-spots`).textContent = totalSpots;
    document.getElementById(`station-${stationId}-total-grp`).textContent = totalGrp.toFixed(2);
    document.getElementById(`station-${stationId}-total-trp`).textContent = totalTrp.toFixed(2);
    document.getElementById(`station-${stationId}-total-affinity`).textContent = totalAffinity;
    document.getElementById(`station-${stationId}-total-before-discount`).textContent = totalBeforeDiscount.toFixed(2);
    document.getElementById(`station-${stationId}-total-after-discount`).textContent = totalAfterDiscount.toFixed(2);
}

function loadExistingSpots() {
    // Load existing spots from the plan
    fetch(`/api/plans/{{ plan.id }}`)
        .then(response => response.json())
        .then(data => {
            if (data.spots) {
                data.spots.forEach(spot => {
                    const row = document.querySelector(`tr[data-station-id="${spot.station_id}"][data-time-slot="${spot.time_slot}"]`);
                    if (row) {
                        const cell = row.querySelector(`td[data-date="${spot.date}"]`);
                        if (cell) {
                            const indicator = cell.querySelector('.spot-indicator');
                            indicator.textContent = spot.spot_count;
                            cell.classList.add('has-spot');
                        }
                        updateRowTotals(row);
                    }
                });
            }
        })
        .catch(error => console.error('Error loading spots:', error));
}

function applyDiscountsToAll() {
    // Get the discount values from inputs
    const ourDiscount = parseFloat(document.getElementById('globalOurDiscount').value) || 0;
    const clientDiscount = parseFloat(document.getElementById('globalClientDiscount').value) || 0;

    // Update all discount cells in the table
    const ourDiscountCells = document.querySelectorAll('.our-discount-percent');
    const clientDiscountCells = document.querySelectorAll('.client-discount-percent');

    ourDiscountCells.forEach(cell => {
        cell.textContent = ourDiscount + '%';
    });

    clientDiscountCells.forEach(cell => {
        cell.textContent = clientDiscount + '%';
    });

    // Recalculate all row prices with new discounts
    const allRows = document.querySelectorAll('.planning-row');
    allRows.forEach(row => {
        recalculateRowPricesWithDiscounts(row, ourDiscount, clientDiscount);
    });

    // Update station totals
    const stationIds = new Set();
    allRows.forEach(row => {
        const stationId = row.dataset.stationId;
        if (stationId) {
            stationIds.add(stationId);
        }
    });

    stationIds.forEach(stationId => {
        updateStationTotals(stationId);
    });

    // Show success message
    showNotification('Nuolaidos pritaikytos visoms eilutėms!', 'success');
}

function recalculateRowPricesWithDiscounts(row, ourDiscount, clientDiscount) {
    // Get values from the row
    const basePrice = parseFloat(row.querySelector('.base-price').textContent || 0);
    const seasonalIndex = parseFloat(row.querySelector('.seasonal-index').textContent || 1.0);
    const spotCount = parseInt(row.querySelector('.spot-count').textContent || 0);

    // Calculate price with seasonal index
    const priceWithIndex = basePrice * seasonalIndex;
    row.querySelector('.price-with-index').textContent = priceWithIndex.toFixed(2);

    // Calculate clip price (single spot price after seasonal adjustment)
    row.querySelector('.clip-price').textContent = priceWithIndex.toFixed(2);

    // Calculate total before discount (price * spot count)
    const totalBeforeDiscount = priceWithIndex * spotCount;
    row.querySelector('.total-before-discount').textContent = totalBeforeDiscount.toFixed(2);

    // Apply discounts
    const priceAfterOurDiscount = totalBeforeDiscount * (1 - ourDiscount / 100);
    const finalPrice = priceAfterOurDiscount * (1 - clientDiscount / 100);
    row.querySelector('.final-price').textContent = priceWithIndex.toFixed(2); // Single spot final price
    row.querySelector('.total-after-discount').textContent = finalPrice.toFixed(2);

    // Calculate TRP price if TRP is available
    const trp = parseFloat(row.querySelector('.trp').textContent || 0);
    if (trp > 0) {
        const trpPrice = priceWithIndex / trp;
        row.querySelector('.trp-price').textContent = trpPrice.toFixed(2);
    }
}

function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed top-0 end-0 m-3`;
    notification.style.zIndex = '9999';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

    document.body.appendChild(notification);

    // Auto-remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Initialize drag-to-scroll functionality for each station table
function initializeDragToScroll() {
    const stationWrappers = document.querySelectorAll('.station-table-wrapper');

    stationWrappers.forEach(wrapper => {
        let isDown = false;
        let startX;
        let scrollLeft;

        wrapper.addEventListener('mousedown', (e) => {
            // Only allow dragging in calendar date area (after the first 20 columns)
            const calendarDateHeaders = wrapper.querySelectorAll('.calendar-date-header');
            const isInCalendarArea = e.target.closest('.calendar-date-header') ||
                                   e.target.classList.contains('calendar-cell') ||
                                   e.target.closest('.calendar-cell');

            if (!isInCalendarArea) {
                return; // Don't allow dragging outside calendar area
            }

            // Allow normal click behavior for calendar cells with spot functionality
            if (e.target.tagName === 'TD' && e.target.classList.contains('calendar-cell')) {
                return;
            }

            isDown = true;
            wrapper.classList.add('active');
            startX = e.pageX - wrapper.offsetLeft;
            scrollLeft = wrapper.scrollLeft;
            e.preventDefault(); // Prevent text selection
        });

        wrapper.addEventListener('mouseleave', () => {
            isDown = false;
            wrapper.classList.remove('active');
        });

        wrapper.addEventListener('mouseup', () => {
            isDown = false;
            wrapper.classList.remove('active');
        });

        wrapper.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - wrapper.offsetLeft;
            const walk = (x - startX) * 2; // Adjust scroll speed multiplier
            wrapper.scrollLeft = scrollLeft - walk;
        });

        // Touch support for mobile devices
        wrapper.addEventListener('touchstart', (e) => {
            const isInCalendarArea = e.target.closest('.calendar-date-header') ||
                                   e.target.classList.contains('calendar-cell') ||
                                   e.target.closest('.calendar-cell');

            if (!isInCalendarArea) {
                return;
            }

            if (e.target.tagName === 'TD' && e.target.classList.contains('calendar-cell')) {
                return;
            }

            isDown = true;
            startX = e.touches[0].pageX - wrapper.offsetLeft;
            scrollLeft = wrapper.scrollLeft;
        });

        wrapper.addEventListener('touchend', () => {
            isDown = false;
        });

        wrapper.addEventListener('touchmove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.touches[0].pageX - wrapper.offsetLeft;
            const walk = (x - startX) * 2;
            wrapper.scrollLeft = scrollLeft - walk;
        });
    });
}

</script>

<style>
/* Professional Design System */
:root {
    --primary-color: #2563eb;
    --primary-hover: #1d4ed8;
    --secondary-color: #64748b;
    --success-color: #059669;
    --background-light: #f8fafc;
    --background-white: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-muted: #94a3b8;
    --border-color: #e2e8f0;
    --border-light: #f1f5f9;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
}

/* Header Section */
.header-section {
    margin-bottom: 2rem;
}

.header-card {
    background: linear-gradient(135deg, #2d3748, #4a5568);
    color: white;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    padding: 2rem;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-light);
}

.campaign-title h1 {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 0.5rem 0;
    line-height: 1.2;
}

.campaign-subtitle {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
}

.header-actions {
    display: flex;
    gap: 0.75rem;
}

/* Info Grid */
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.clips-section {
    border-top: 1px solid var(--border-light);
    padding-top: 1.5rem;
}

.info-item {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
    padding: 1rem;
    transition: all 0.2s ease;
}

.info-item:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.info-item.full-width {
    grid-column: 1 / -1;
}

.info-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.info-icon {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1rem;
}

.info-label {
    color: #ffffff;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.info-value {
    color: #ffffff;
    font-size: 0.875rem;
    font-weight: 600;
    line-height: 1.4;
    background: rgba(255, 255, 255, 0.15);
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 0.25rem;
    display: inline-block;
    min-width: 100px;
}

/* Professional Buttons */
.btn-professional {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    cursor: pointer;
}

.btn-professional.btn-primary {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-professional.btn-primary:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn-professional.btn-secondary {
    background: var(--background-white);
    color: var(--text-secondary);
    border-color: var(--border-color);
}

.btn-professional.btn-secondary:hover {
    background: var(--background-light);
    color: var(--text-primary);
    border-color: var(--secondary-color);
}

.btn-professional.btn-full {
    width: 100%;
    justify-content: center;
}

/* Professional Sections */
.professional-section {
    background: var(--background-white);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    margin-bottom: 2rem;
    overflow: hidden;
}

/* Station Sections - Individual spacing */
.station-section {
    margin-bottom: 3rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border-light);
    background: var(--background-light);
}

.section-title h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.25rem 0;
}

.section-subtitle {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

/* Controls Grid */
.controls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    padding: 1.5rem 2rem;
}

.control-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.control-label {
    color: var(--text-primary);
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.input-group-professional {
    position: relative;
    display: flex;
}

.form-control-professional {
    flex: 1;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    color: var(--text-primary);
    background: var(--background-white);
    transition: all 0.2s ease;
}

.form-control-professional:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
}

.input-suffix {
    padding: 0.5rem 0.75rem;
    background: var(--background-light);
    border: 1px solid var(--border-color);
    border-left: none;
    border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.help-text {
    color: var(--text-muted);
    font-size: 0.75rem;
    line-height: 1.4;
    margin-top: 0.5rem;
}

/* Table Container */
.table-container {
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    overflow: hidden;
}

/* Professional Tables */
.professional-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
    background: var(--background-white);
}

.professional-table th {
    background: var(--background-light);
    color: var(--text-primary);
    font-weight: 600;
    padding: 0.75rem;
    text-align: center;
    border-bottom: 2px solid var(--border-color);
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.professional-table .station-column {
    text-align: left;
    min-width: 150px;
    background: var(--background-white);
    font-weight: 600;
    color: var(--text-primary);
}

.professional-table td {
    padding: 0.5rem;
    border-bottom: 1px solid var(--border-light);
    text-align: center;
    vertical-align: middle;
}

.professional-table tbody tr:hover {
    background: var(--background-light);
}

/* Weekend styling */
.weekend-header {
    background: #fef2f2 !important;
    color: #991b1b;
}

.weekend-cell {
    background: #fef2f2;
}

.weekend-cell input {
    background: #fef2f2;
    border-color: #fecaca;
}

/* Calendar inputs */
.calendar-input-cell input {
    width: 60px;
    padding: 0.25rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    text-align: center;
    font-size: 0.75rem;
    background: var(--background-white);
}

.calendar-input-cell input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgb(37 99 235 / 0.1);
}

/* Planning Table Styling */
.planning-table-container {
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    overflow: hidden;
    background: var(--background-white);
}

.planning-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.75rem;
    background: var(--background-white);
    min-width: 1800px; /* Ensure horizontal scrolling when needed */
}

/* Main Header Row */
.planning-table .main-header th {
    background: linear-gradient(135deg, #1e293b, #334155);
    color: white;
    padding: 1rem 0.5rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: none;
    vertical-align: middle;
    position: relative;
}

/* Group Headers with Different Colors */
.rating-group-header {
    background: linear-gradient(135deg, #059669, #10b981) !important;
}

.pricing-group-header {
    background: linear-gradient(135deg, #dc2626, #ef4444) !important;
}

.totals-group-header {
    background: linear-gradient(135deg, #7c3aed, #8b5cf6) !important;
}

.discount-group-header {
    background: linear-gradient(135deg, #ea580c, #f97316) !important;
}

/* Sub Header Row */
.planning-table .sub-header th {
    background: var(--background-light);
    color: var(--text-primary);
    padding: 0.75rem 0.5rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.65rem;
    border-bottom: 2px solid var(--border-color);
    vertical-align: middle;
}

/* Station and Basic Info Headers */
.station-header, .time-header, .weekday-header {
    background: linear-gradient(135deg, #475569, #64748b) !important;
    color: white;
    min-width: 100px;
}

.station-header {
    min-width: 120px;
    text-align: left !important;
}

/* Date Headers */
.calendar-date-header {
    background: var(--background-light) !important;
    min-width: 50px;
    padding: 0.5rem 0.25rem !important;
}

.calendar-date-header.weekend-date {
    background: linear-gradient(135deg, #fef2f2, #fee2e2) !important;
    color: #991b1b;
}

.date-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.125rem;
}

.date-day {
    font-weight: 700;
    font-size: 0.75rem;
}

.date-month {
    font-size: 0.6rem;
    opacity: 0.8;
}

/* Table Body Styling */
.planning-table tbody td {
    padding: 0.5rem 0.25rem;
    border-bottom: 1px solid var(--border-light);
    text-align: center;
    vertical-align: middle;
    font-size: 0.7rem;
    background: var(--background-white);
}

.planning-table tbody tr:hover {
    background: var(--background-light);
}

/* Station Separator Rows */
.station-separator td {
    height: 8px !important;
    padding: 0 !important;
    background: linear-gradient(90deg, var(--border-color), var(--border-light), var(--border-color)) !important;
    border: none !important;
}

/* Station Header Rows */
.station-header-row td {
    background: linear-gradient(135deg, #f1f5f9, #e2e8f0) !important;
    font-weight: 600 !important;
    color: var(--text-primary) !important;
    border-top: 2px solid var(--border-color) !important;
    border-bottom: 1px solid var(--border-color) !important;
    padding: 0.75rem 0.5rem !important;
}

/* Station Totals Rows */
.station-totals td {
    background: linear-gradient(135deg, #fff7ed, #ffedd5) !important;
    font-weight: 600 !important;
    border-top: 2px solid #fed7aa !important;
    border-bottom: 2px solid #fed7aa !important;
}

/* Weekend Rows */
.weekend-row td {
    background: #fefefe !important;
}

.weekend-row:hover td {
    background: #fef2f2 !important;
}

/* Calendar Cells */
.calendar-cell {
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease;
    min-width: 50px;
}

.calendar-cell:hover {
    background: #e0f2fe !important;
    transform: scale(1.05);
}

.calendar-cell.has-spot {
    background: linear-gradient(135deg, #dcfce7, #bbf7d0) !important;
    border: 1px solid #22c55e !important;
}

.spot-indicator {
    font-weight: 700;
    color: #059669;
    font-size: 0.8rem;
}

/* Numeric Cells */
.grp, .trp, .total-grp, .total-trp, .affinity,
.trp-price, .base-price, .final-price, .total-before-discount, .total-after-discount {
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    font-weight: 500;
    min-width: 70px;
}

/* Weekend Calendar Cells */
.weekend-cell {
    background: #fef2f2 !important;
}

.weekend-row .calendar-cell:not(.weekend-cell) {
    background: #f5f5f5 !important;
    opacity: 0.6;
    cursor: not-allowed;
}

/* Table responsive wrapper */
.table-responsive {
    overflow-x: auto;
    max-width: 100%;
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
}

/* Station Table Wrapper - Individual scrolling */
.station-table-wrapper {
    overflow-x: auto;
    max-width: 100%;
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
}

/* Grab cursor only for calendar area where dragging is actually possible */
.calendar-date-header {
    cursor: grab;
}

.calendar-cell:not(.has-spot) {
    cursor: grab;
}

.calendar-cell.has-spot {
    cursor: pointer;
}

/* Grabbing cursor when actively dragging */
.station-table-wrapper:active .calendar-date-header,
.station-table-wrapper:active .calendar-cell:not(.has-spot) {
    cursor: grabbing;
}

/* Ensure other table cells have default cursor */
.planning-table td:not(.calendar-cell),
.planning-table th:not(.calendar-date-header) {
    cursor: default;
}

.station-table-wrapper::-webkit-scrollbar {
    height: 8px;
}

.station-table-wrapper::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

.station-table-wrapper::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
}

.station-table-wrapper::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

/* Calendar table styling */
#calendar-table {
    font-size: 13px;
}

#calendar-table th {
    vertical-align: middle;
    text-align: center;
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    padding: 8px 4px;
}

.weekend-header {
    background-color: #f8d7da !important;
    color: #721c24;
}

.station-name-cell {
    background-color: #e9ecef;
    font-weight: bold;
    vertical-align: middle;
    padding: 8px 12px;
    min-width: 150px;
}

.calendar-input-cell {
    text-align: center;
    vertical-align: middle;
    padding: 4px !important;
    min-width: 80px;
}

.calendar-input-cell.weekend-cell {
    background-color: #fef2f2;
}

.calendar-input-cell input {
    border: 1px solid #ced4da;
    border-radius: 4px;
    padding: 2px 4px;
    text-align: center;
    width: 60px;
    margin: 0 auto;
}

.calendar-input-cell input:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.weekend-cell input {
    background-color: #fff5f5;
    border-color: #f8c2c5;
}

.table-responsive {
    overflow-x: auto;
    max-width: 100%;
}

.radio-planning-table {
    font-size: 11px;
}

.radio-planning-table th,
.radio-planning-table td {
    min-width: 50px;
    padding: 4px 6px;
    text-align: center;
    vertical-align: middle;
}

.calendar-cell {
    cursor: pointer;
    position: relative;
    width: 60px;
    height: 30px;
}

.calendar-cell:hover {
    background-color: #e9ecef;
}

.calendar-cell.has-spot {
    background-color: #d4edda;
}

.spot-indicator {
    font-weight: bold;
    color: #155724;
}

.calendar-date-header {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    font-size: 10px;
    width: 60px;
}

.table-container {
    overflow-x: auto;
}
</style>
{% endblock %}